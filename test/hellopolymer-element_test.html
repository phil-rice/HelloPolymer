<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>helloPolymer-element test</title>

    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../web-component-tester/browser.js"></script>
    <script src="../node_modules/pact-web/pact-web.js"></script>

    <link rel="import" href="../hellopolymer-element.html">
</head>
<body>

<test-fixture id="BasicTestFixture">
    <template>
        <hellopolymer-element></hellopolymer-element>
    </template>
</test-fixture>

<test-fixture id="ChangedPropertyTestFixture">
    <template>
        <hellopolymer-element prop1="new-prop1"></hellopolymer-element>
    </template>
</test-fixture>

<script>
    console.log("Got to the console.log statement")
    suite('hellopolymer-element', function () {

        test('instantiating the element with default properties works', function () {
            var element = fixture('BasicTestFixture');
            assert.equal(element.prop1, 'hellopolymer-element');
            var elementShadowRoot = element.shadowRoot;
            var elementHeader = elementShadowRoot.querySelector('h2');
            assert.equal(elementHeader.innerHTML, 'Hello hellopolymer-element!');
        });

        test('setting a property on the element works', function () {
            // Create a test fixture
            var element = fixture('ChangedPropertyTestFixture');
            assert.equal(element.prop1, 'new-prop1');
            var elementShadowRoot = element.shadowRoot;
            var elementHeader = elementShadowRoot.querySelector('h2');
            assert.equal(elementHeader.innerHTML, 'Hello new-prop1!');
        });

        console.log("Got to test PAct is ", Pact)

        provider = Pact({
            consumer: 'Friends Client',
            provider: 'Friends API',
            spec: '3.0.0' // https://github.com/pact-foundation/pact-specification
        });
        console.log("Got to test provider is ", provider)

        test('setting a property on the element works', function () {
            console.log('addInteraction-->sayHello');
            // Register an expectation on the Mock Server, which must be called by your test case(s). You can add multiple interactions per
            // server. These will be validated and written to a pact if successful.
            provider.addInteraction({
                uponReceiving: 'a request for hello',
                withRequest: {
                    method: 'GET',
                    path: '/sayHello'
                },
                willRespondWith: {
                    status: 200,
                    headers: {"Content-Type": "application/json"},
                    body: {reply: "Hello"}
                }
            }).then(function () {
                console.log('addInteraction-->sayHello done');
                done();
            }, function (err) {
                console.log('addInteraction-->sayHello error: ' + err);
                done.fail(err);
            })

        });
    });
</script>

</body>
</html>
