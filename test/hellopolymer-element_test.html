<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>helloPolymer-element test</title>

    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../web-component-tester/browser.js"></script>

    <link rel="import" href="../hellopolymer-element.html">
  </head>
  <body>

    <test-fixture id="BasicTestFixture">
      <template>
        <hellopolymer-element></hellopolymer-element>
      </template>
    </test-fixture>

    <test-fixture id="ChangedPropertyTestFixture">
      <template>
        <hellopolymer-element prop1="new-prop1"></hellopolymer-element>
      </template>
    </test-fixture>

    <script>
      console.log("Got to the console.log statement")
      suite('hellopolymer-element', function() {

        test('instantiating the element with default properties works', function() {
          var element = fixture('BasicTestFixture');
          assert.equal(element.prop1, 'hellopolymer-element');
          var elementShadowRoot = element.shadowRoot;
          var elementHeader = elementShadowRoot.querySelector('h2');
          assert.equal(elementHeader.innerHTML, 'Hello hellopolymer-element!');
        });

        test('setting a property on the element works', function() {
          // Create a test fixture
          var element = fixture('ChangedPropertyTestFixture');
          assert.equal(element.prop1, 'new-prop1');
          var elementShadowRoot = element.shadowRoot;
          var elementHeader = elementShadowRoot.querySelector('h2');
          assert.equal(elementHeader.innerHTML, 'Hello new-prop1!');
        });
          var expect = require('chai').expect
          var request = require('superagent')

          var PactOpts = {
              consumer: 'PactUI',             // the name of your consumer
              provider: 'Projects Provider',  // the name of your Provider
              providerPort: 1234              // the port on which the provider runs
          }

          PactConsumer(PactOpts, function () {

              // this is wrapped in a before() block
              // it takes an Array of interactions
              addInteractions([{
                  state: 'i have a list of projects',
                  uponReceiving: 'a request for projects',
                  withRequest: {
                      method: 'get',
                      path: '/projects',
                      headers: { 'Accept': 'application/json' }
                  },
                  willRespondWith: {
                      status: 200,
                      headers: { 'Content-Type': 'application/json; charset=utf-8' },
                      body: { reply: 'hello' }
                  }
              }])

              function requestProjects () {
                  return request.get('http://localhost:' + PactOpts.providerPort + '/projects').set({ 'Accept': 'application/json' })
              }

              // this is your 'it' block
              verify('a list of projects is returned', requestProjects, function (result, done) {
                  expect(JSON.parse(result)).to.eql({ reply: 'hello' })
                  done()
              })

              // this is wrapped in a after block
              // thus it runs after all your verify's
              // it writes the pact and clear all interactions
              finalizePact()

          })
      });
    </script>

  </body>
</html>
